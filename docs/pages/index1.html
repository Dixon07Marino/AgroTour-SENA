<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar sesión | Portal</title>
    <link rel="stylesheet" href="./docs/styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
</head>
<body class="bg flex items-center justify-center min-h-screen bg-gray-100">
    <div class="w-full max-w-md bg-white p-8 rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold text-center mb-4">Iniciar Sesión</h2>
        <form id="loginForm" class="space-y-4">
            <input type="email" id="loginEmail" placeholder="Correo electrónico" required
                   class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
            <div class="relative">
                <input type="password" id="loginPassword" placeholder="Contraseña" required
                       class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                <button type="button" class="absolute right-3 top-3" id="toggleLoginPassword">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         class="eye-icon">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
            </div>
            <button type="submit"
                    class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600">Iniciar
                sesión</button>
        </form>
        <p id="login-error-message" class="text-red-500 text-sm mt-2"></p>

        <hr class="my-4">
        
        <h2 class="text-2xl font-bold text-center mb-4">Registro de Usuario</h2>
        <form id="registerForm" class="space-y-4">
            <input type="text" id="registerName" placeholder="Nombre del usuario" required
                   class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
            <input type="email" id="registerEmail" placeholder="Correo electrónico" required
                   class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
            <div class="relative">
                <input type="password" id="registerPassword" placeholder="Contraseña" required
                       class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                <button type="button" class="absolute right-3 top-3" id="toggleRegisterPassword">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         class="eye-icon">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
            </div>
            <div class="relative">
                <input type="password" id="registerPassword2" placeholder="Confirmar contraseña" required
                       class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                <button type="button" class="absolute right-3 top-3" id="toggleRegisterPassword2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         class="eye-icon">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
            </div>
            <button type="submit"
                    class="w-full bg-green-500 text-white py-2 rounded-md hover:bg-green-600">Registrarse</button>
        </form>
        <p id="register-error-message" class="text-red-500 text-sm mt-2"></p>
    </div>

    <script>
        // Configuración de la URL base para las peticiones
        // const API_URL = 'http://localhost:3000/api/auth/';
        const API_URL = 'https://agrotur-back.vercel.app/api/auth/';

        // Función para mostrar/ocultar contraseña
        function togglePassword(inputId, eyeButtonId) {
            const input = document.getElementById(inputId);
            const eyeIcon = document.querySelector(`#${eyeButtonId} .eye-icon`);
            
            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.innerHTML = `<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/><circle cx="12" cy="12" r="2.75"/>`;
            } else {
                input.type = 'password';
                eyeIcon.innerHTML = `<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/><circle cx="12" cy="12" r="3"/>`;
            }
        }

        // Event listeners para los botones del ojo
        document.getElementById('toggleLoginPassword').addEventListener('click', () => {
            togglePassword('loginPassword', 'toggleLoginPassword');
        });

        document.getElementById('toggleRegisterPassword').addEventListener('click', () => {
            togglePassword('registerPassword', 'toggleRegisterPassword');
        });

        document.getElementById('toggleRegisterPassword2').addEventListener('click', () => {
            togglePassword('registerPassword2', 'toggleRegisterPassword2');
        });

        // Manejo del formulario de inicio de sesión
        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;
            const errorMessage = document.getElementById("login-error-message");

            try {
                const response = await fetch(`${API_URL}login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        password
                    })
                });

                if (!response.ok) {
                    throw new Error(await response.text());
                }

                const data = await response.json();
                alert("Inicio de sesión exitoso");
                window.location.replace("./docs/pages/home/index.html");
            } catch (error) {
                errorMessage.textContent = error.message;
            }
        });

        // Manejo del formulario de registro
        document.getElementById("registerForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const name = document.getElementById("registerName").value;
            const email = document.getElementById("registerEmail").value;
            const password = document.getElementById("registerPassword").value;
            const password2 = document.getElementById("registerPassword2").value;
            const errorMessage = document.getElementById("register-error-message");

            if (password !== password2) {
                errorMessage.textContent = "Las contraseñas no coinciden.";
                return;
            }

            try {
                const response = await fetch(`${API_URL}register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        email,
                        password
                    })
                });

                if (!response.ok) {
                    throw new Error(await response.text());
                }

                const data = await response.json();
                alert("Registro exitoso del usuario ", name);
            } catch (error) {
                errorMessage.textContent = error.message;
            }
        });
    </script>
</body>
</html>